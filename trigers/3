DELIMITER //

-- Триггер для проверки минимальной суммы инвестиции
CREATE TRIGGER TRG_Investment_MinAmount_BeforeInsert
BEFORE INSERT ON INVESTMENT
FOR EACH ROW
BEGIN
    DECLARE min_amount_security DECIMAL(15,2) DEFAULT 1000.000; -- Минимальная сумма для ценных бумаг
    DECLARE min_amount_deposit DECIMAL(15,2) DEFAULT 10000.000; -- Минимальная сумма для депозитов
    
    IF NEW.Investment_Type = 'SECURITY' THEN
        IF NEW.Amount < min_amount_security THEN
            SIGNAL SQLSTATE '45000' 
            SET MESSAGE_TEXT = 'Минимальная сумма инвестиции в ценные бумаги: 1000.00';
        END IF;
    ELSEIF NEW.Investment_Type = 'DEPOSIT' THEN
        IF NEW.Amount < min_amount_deposit THEN
            SIGNAL SQLSTATE '45000' 
            SET MESSAGE_TEXT = 'Минимальная сумма инвестиции в депозит: 10000.00';
        END IF;
    END IF;
END //

DELIMITER ;
Тестирование триггера:

sql
-- Попытка вставить инвестицию с суммой меньше минимальной
INSERT INTO INVESTMENT (Client_ID, Security_ID, Deposit_ID, Investment_Type, Amount, Purchase_Date, Purchase_Rate, Status) 
VALUES (1, 1, NULL, 'SECURITY', 500.00, '2024-03-01', 280.50, 'ACTIVE');
-- Ожидаем ошибку: "Минимальная сумма инвестиции в ценные бумаги: 1000.00"

-- Попытка вставить депозит с суммой меньше минимальной
INSERT INTO INVESTMENT (Client_ID, Security_ID, Deposit_ID, Investment_Type, Amount, Purchase_Date, Purchase_Rate, Status) 
VALUES (1, NULL, 1, 'DEPOSIT', 5000.00, '2024-03-01', 8.5, 'ACTIVE');
-- Ожидаем ошибку: "Минимальная сумма инвестиции в депозит: 10000.00"

-- Успешная вставка с корректной суммой
INSERT INTO INVESTMENT (Client_ID, Security_ID, Deposit_ID, Investment_Type, Amount, Purchase_Date, Purchase_Rate, Status) 
VALUES (1, 1, NULL, 'SECURITY', 5000.00, '2024-03-01', 280.50, 'ACTIVE');
-- Должно быть успешно
